// ============================================
// ПЛАТЕЖИ (Тинькофф Касса)
// ============================================

enum PaymentStatus {
  CREATED     // Платёж создан
  PENDING     // Ожидает оплаты
  COMPLETED   // Оплата прошла
  FAILED      // Ошибка оплаты
  REFUNDED    // Возврат
}

model Payment {
  id              String        @id
  amount          Float                  // Сумма в рублях
  status          PaymentStatus @default(CREATED)

  // Связи
  organizationId  String
  organization    Organization  @relation(fields: [organizationId], references: [id])
  tariffId        String
  tariff          Tariff?       @relation(fields: [tariffId], references: [id])
  billingId       String?
  billing         Billing?      @relation(fields: [billingId], references: [id])

  // Провайдер платежей (Тинькофф)
  providerPaymentId String?     @unique  // PaymentId от Тинькофф
  paymentUrl        String?     @db.Text // Ссылка на форму оплаты
  providerStatus    String?              // Статус от Тинькофф (NEW, CONFIRMED, и т.д.)

  // Период подписки
  periodStart     DateTime?
  periodEnd       DateTime?

  createdAt       DateTime      @default(now())
  completedAt     DateTime?
  error           String?       @db.Text

  @@index([organizationId])
  @@index([providerPaymentId])
  @@index([status])
}
