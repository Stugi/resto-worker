// ============================================
// ТРАНСКРИПЦИИ (Whisper)
// ============================================

model Transcript {
  id              String   @id
  text            String   @db.Text    // Текст транскрипции
  language        String?              // Определённый язык (ru, en...)
  durationMs      Int?                 // Время обработки Whisper (мс)

  // GPT-классификация отзыва
  sentiment       String?              // positive | negative | neutral | mixed
  category        String?              // food | service | atmosphere | loyalty | wow
  subcategory     String?              // temperature | taste | foreign_object | cooking | quality (только для food)
  dishes          String?  @db.Text    // JSON: ["Стейк рибай", "Ролл Верона"]
  severity        Int?                 // 1-5 (1=мелочь, 5=критический инцидент)
  problemTypes    String?  @db.Text    // JSON: ["cold_food", "hair_found"]
  classifiedAt    DateTime?            // Когда классифицирован (null = ещё нет)

  // Связи
  voiceMessageId  String   @unique
  voiceMessage    VoiceMessage @relation(fields: [voiceMessageId], references: [id])

  restaurantId    String
  restaurant      Restaurant @relation(fields: [restaurantId], references: [id])

  userId          String?
  user            User?    @relation(fields: [userId], references: [id])

  // Используется в отчётах
  reports         ReportTranscript[]

  createdAt       DateTime @default(now())

  @@index([restaurantId])
  @@index([createdAt])
  @@index([sentiment])
  @@index([category])
  @@index([restaurantId, createdAt, sentiment])
}
