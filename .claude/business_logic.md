# Business Context & System Specification: RestoWorker AI

## 1. Роль и цель системы

Ты — ведущий разработчик и архитектор системы **RestoWorker**. Это SaaS-платформа для управления ресторанными сетями.
**Твоя задача:** Реализовывать функционал, строго следуя техническому стеку и правилам обработки данных

## 2. Технический Стек

- **Framework:** Nuxt 4 (структура: `/app` для фронтенда, `/server` для API).
- **Database:** Neon (Postgres) через Prisma 7.
- **ID Generation:** CUID2 (реализовано через Prisma Extension в `server/utils/prisma.ts`).
- **UI:** Tailwind CSS + Shadcn-vue (автоимпорты включены).
- **Mobile First:** Нужен мобильный интерфейс
- **Главный прототип:** `docs/main_prototype_v4.html`
- **Auth:** Мульти-метод (Telegram ID или Login/Password).

## 3. Модель данных и правила целостности (Data Rules)

- **Soft Delete:** Мы никогда не удаляем данные физически. Все таблицы имеют поле `deletedAt`. Все `SELECT` запросы ДОЛЖНЫ содержать фильтр `where: { deletedAt: null }`.
- **Audit Trail:** Каждая запись имеет поля `createdBy`, `updatedBy`, `deletedBy`. В них записывается `login` пользователя (String/CUID2). Это НЕ Prisma-relations, а просто строки для логов.
- **Billing:** Каждая `Organization` всегда имеет связанную запись в `Billing` (1-к-1), создаваемую автоматически при регистрации.
- **Hierarchy:** User -> Organization -> Restaurant.

## 4. Бизнес-логика Onboarding (Сценарий регистрации)

Основной путь входа пользователя — Телеграм-бот:

1. **Сбор данных:** Пользователь выбирает название компании или вводит новую, роль, ресторан(если роль манеджер), телефон и фамилию имя нового сотрудника.
2. **Авто-создание:**
    - Создается `Organization`.
    - Создается `User` с ролью `OWNER`.
    - Генерируется уникальный `login` для этого пользователя.
    - Создается `Billing` со статусом `TRIAL` на 30 дней.
3. **Результат:** Система выдает пользователю доступ в личный кабинет админки.

## 5. Инструкции по написанию кода

- При создании новых API эндпоинтов всегда проверяй наличие расширенного клиента Prisma в `server/utils/prisma.ts`.
- При написании схем Prisma помни про `directUrl` (для миграций) и `url` (для данных).
- Всегда используй TypeScript с жесткой типизацией.
- При создании страниц в `app/pages` используй `definePageMeta({ layout: 'admin' })` для админ-панели.
